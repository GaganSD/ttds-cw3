# -*- coding: utf-8 -*-
"""PaperswithCode.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1GHmKuAIldqHMtOughK_CkfbrYTZTLN51
"""

from ../mongoDB_api_live_index import *
from ../live_index_generator import *
import os
import json
import pandas as pd

def live_index():
  os.system("wget https://production-media.paperswithcode.com/about/papers-with-abstracts.json.gz")
  os.system("gzip -d papers*")

  with open('papers-with-abstracts.json') as f:
    data = json.load(f)

  df = pd.DataFrame(data)
  df = df[['title', 'abstract', 'url_abs', 'authors', 'date']]
  df.rename(columns={"url_abs": "url"}, inplace=True)
  df.loc[:, 'date'] = pd.to_datetime(df['date']).dt.strftime("%d/%m/%Y")
  df.loc[:, 'authors'] = df['authors'].str.join(", ")

  client = MongoDBClient("34.142.18.57")

  # Update Index
  indexGen = IndexGenerator(client_ip = "34.142.18.57", activate_stemming = True, activate_stop = False, start_index=0, local_dataset=df, source_name="paperswithcode", identifier="url")
  indexGen.clean_indexing()
  indexGen.run_indexing()

  # insert_dataset_data
  success_num = client.insert_data(df, "paper", "paperswithcode", "url")
  print("# data inserted ", success_num)